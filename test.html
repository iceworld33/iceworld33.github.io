<!DOCTYPE html>
<html lang="en">
<head>
    <title>three.js webgl - loaders - OBJ loader</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <style>
        body {
            font-family: Monospace;
            background-color: #000;
            color: #fff;
            margin: 0px;
            overflow: hidden;
        }
        #info {
            color: #fff;
            position: absolute;
            top: 10px;
            width: 100%;
            text-align: center;
            z-index: 100;
            display:block;
        }
        #info a, .button { color: #f00; font-weight: bold; text-decoration: underline; cursor: pointer }
    </style>
</head>

<body>
<div id="info">
    <a href="http://threejs.org" target="_blank">three.js</a> - OBJLoader test
</div>

<script src="build/three.min.js"></script>
<script src="js/loaders/OBJLoader.js"></script>
<script src="js/controls/OrbitControls.js"></script>
<script src="js/Detector.js"></script>
<script src="js/libs/stats.min.js"></script>
<script>

    var container, stats;

    var camera, scene, renderer,controls;
    var box,t1,t2,t3,s1,s2,s3,dis;
    init();
    animate();


    function init() {

        container = document.createElement( 'div' );
        document.body.appendChild( container );
        scene = new THREE.Scene();

        var ambient = new THREE.AmbientLight( 0x101030 );
        scene.add( ambient );

        var directionalLight = new THREE.DirectionalLight( 0xffeedd );
        directionalLight.position.set( 0, 0, 1 );
        scene.add( directionalLight );

        // texture

        var manager = new THREE.LoadingManager();
        manager.onProgress = function ( item, loaded, total ) {

            console.log( item, loaded, total );

        };

        var texture = new THREE.Texture();

        var onProgress = function ( xhr ) {
            if ( xhr.lengthComputable ) {
                var percentComplete = xhr.loaded / xhr.total * 100;
                console.log( Math.round(percentComplete, 2) + '% downloaded' );

            }
        };

        var onError = function ( xhr ) {
        };


        var loader = new THREE.ImageLoader( manager );
        loader.load( '4/cup.jpg', function ( image ) {

            texture.image = image;
            texture.needsUpdate = true;

        } );

        // model

        var loader = new THREE.OBJLoader( manager );
        loader.load( '4/male02.obj', function ( object ) {
            box = new THREE.Box3().setFromObject(object);
            t1=box.max.x+box.min.x;
            t2=box.max.y+box.min.y;
            t3=box.max.z+box.min.z;
            s1=box.max.x-box.min.x;
            s2=box.max.y-box.min.y;
            s3=box.max.z-box.min.z;
            object.traverse( function ( child ) {

                if ( child instanceof THREE.Mesh ) {

                    child.material.map = texture;
                }

            } );
            if(box.min.x+box.max.x>0){
                object.position.x=-t1/2;
            }
            else if(box.min.x+box.max.x<0){
                object.position.x=t1/2;
            }
            if(box.min.y+box.max.y>0){
               object.position.y=-t2/2;
            }
            else if(box.min.y+box.max.y<0){
                object.position.y=t2/2;
            }
            if(box.min.z+box.max.z>0){
                object.position.z=-t3/2;
            }
            else if(box.min.z+box.max.z<0){
                object.position.z=t3/2;
            }
            if(s1>s2){
                dis=s1;
            }else{
                dis=s2;
            }
            if(dis<s3){
                dis=s3;
            }
            scene.add( object );
            camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 1, 2000 );
            camera.position.z = 2*dis;

            controls = new THREE.OrbitControls(camera );

            controls.rotateSpeed = 3.0;
            controls.zoomSpeed = 5;
            controls.panSpeed = 2;

            controls.noZoom = false;
            controls.noPan = false;

            controls.staticMoving = true;
            controls.dynamicDampingFactor = 0.3;
            // scene

            scene.add( camera );
        }, onProgress, onError );


        renderer = new THREE.WebGLRenderer();
        renderer.setPixelRatio( window.devicePixelRatio );
        renderer.setSize( window.innerWidth, window.innerHeight );
        container.appendChild( renderer.domElement );

        window.addEventListener( 'resize', onWindowResize, false );

    }

    function onWindowResize() {

        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();

        renderer.setSize( window.innerWidth, window.innerHeight );
        controls.handleResize();
    }

    function animate() {

        requestAnimationFrame( animate );

        controls.update();
        renderer.render( scene, camera );

        stats.update();
    }


</script>

</body>
</html>
